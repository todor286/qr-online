<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>Админ панел</title>
<style>
body { font-family: Arial; padding: 20px; }
#login, #panel { max-width: 600px; }
.hidden { display: none; }
input, button { padding: 8px; margin: 5px 0; width: 100%; }
.box { border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; }
</style>
</head>
<body>

<h1>Админ панел</h1>

<!-- LOGIN -->
<div id="login" class="box">
  <h2>Вход</h2>
  <input id="pass" type="password" placeholder="Админ парола">
  <button onclick="login()">Влез</button>
  <p id="err" style="color:red;"></p>
</div>

<!-- PANEL -->
<div id="panel" class="hidden">

  <div class="box">
    <h3>Добави проект</h3>
    <input id="pname" placeholder="Име на проект">
    <button onclick="addProject()">Добави</button>
  </div>

  <div class="box">
    <h3>Добави оператор</h3>
    <input id="uname" placeholder="Име на оператор">
    <button onclick="addUser()">Добави</button>
  </div>

  <div class="box">
    <h3>Отчети</h3>
    <button onclick="loadRecords()">Обнови</button>
    <pre id="out"></pre>
  </div>

</div>

<script>
let token = "";

async function login() {
  let pass = document.getElementById("pass").value;

  let r = await fetch("/api/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ password: pass })
  });

  let data = await r.json();

  if (data.token) {
    token = data.token;
    document.getElementById("login").classList.add("hidden");
    document.getElementById("panel").classList.remove("hidden");
  } else {
    document.getElementById("err").innerText = "Грешна парола!";
  }
}

async function addProject() {
  let name = document.getElementById("pname").value;
  await fetch("/api/projects", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify({ name })
  });
  alert("OK");
}

async function addUser() {
  let name = document.getElementById("uname").value;
  await fetch("/api/users", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify({ name })
  });
  alert("OK");
}

async function loadRecords() {
  let r = await fetch("/api/records", {
    headers: { "Authorization": "Bearer " + token }
  });
  let data = await r.json();
  document.getElementById("out").innerText = JSON.stringify(data, null, 2);
}
</script>

</body>
</html>
